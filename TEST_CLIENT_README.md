# FastFile æµ‹è¯•å®¢æˆ·ç«¯ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯• FastFile æœåŠ¡çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œæ”¯æŒå®Œæ•´çš„ä¸Šä¼ ã€ä¸‹è½½æµç¨‹æµ‹è¯•ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ç›´æ¥ä¸Šä¼ åˆ° R2
- âœ“ ä½¿ç”¨é¢„ç­¾å URL ç›´æ¥ä¸Šä¼ åˆ° R2ï¼Œä¸ç»è¿‡ Worker
- âœ“ å‡å°‘ Worker çš„å¸¦å®½å’Œè®¡ç®—è´Ÿæ‹…
- âœ“ æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆæœ€å¤§ 10GBï¼‰

### äº¤äº’å¼è°ƒè¯•æ¨¡å¼
- âœ“ æ¯ä¸ªåˆ†å—ä¸Šä¼ å®Œæš‚åœï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- âœ“ å®Œæˆä¸Šä¼ ï¼ˆconfirmï¼‰æ—¶æš‚åœ
- âœ“ æ–¹ä¾¿è°ƒè¯•å’Œè§‚å¯Ÿä¸Šä¼ è¿‡ç¨‹

### å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•
- âœ“ æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
- âœ“ ç”Ÿæˆéšæœºæ–‡ä»¶æµ‹è¯•
- âœ“ æ–‡ä»¶ä¸‹è½½æµ‹è¯•
- âœ“ å¯†ç éªŒè¯æµ‹è¯•

## å®‰è£…ä¾èµ–

```bash
# æ— éœ€å®‰è£…é¢å¤–ä¾èµ–ï¼Œä½¿ç”¨ Node.js å†…ç½®æ¨¡å—
node --version  # éœ€è¦ Node.js 18+
```

## ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹å¸®åŠ©

```bash
node test-client.js
```

### 2. ä¸Šä¼ æ–‡ä»¶

**æ™®é€šæ¨¡å¼ï¼ˆå¿«é€Ÿä¸Šä¼ ï¼‰ï¼š**
```bash
node test-client.js upload /path/to/file.zip 1234
```

**äº¤äº’æ¨¡å¼ï¼ˆé€æ­¥è°ƒè¯•ï¼‰ï¼š**
```bash
node test-client.js upload /path/to/file.zip 1234 --interactive

# æˆ–ä½¿ç”¨ç®€å†™
node test-client.js upload /path/to/file.zip 1234 -i
```

**ä¸Šä¼ æµç¨‹ï¼ˆäº¤äº’æ¨¡å¼ï¼‰ï¼š**
```
1. åˆå§‹åŒ–ä¸Šä¼ ï¼Œè·å–é¢„ç­¾å URL
   â†“ [æŒ‰ Enter ç»§ç»­]
2. å¼€å§‹ä¸Šä¼ åˆ†å—
   - ä¸Šä¼  Part 1/10
   â†“ [æŒ‰ Enter ç»§ç»­]
   - ä¸Šä¼  Part 2/10
   â†“ [æŒ‰ Enter ç»§ç»­]
   ... (æ¯ä¸ªåˆ†å—éƒ½ä¼šæš‚åœ)
   â†“ [æŒ‰ Enter ç»§ç»­]
3. å®Œæˆä¸Šä¼ ï¼ˆconfirmï¼‰
   â†“ [æŒ‰ Enter ç»§ç»­]
4. ç­‰å¾…åå°å¤„ç†
   âœ“ è·å¾—æ–‡ä»¶ ID å’Œä¸‹è½½é“¾æ¥
```

### 3. æµ‹è¯•ä¸Šä¼ ï¼ˆç”Ÿæˆéšæœºæ–‡ä»¶ï¼‰

```bash
# ç”Ÿæˆå¹¶ä¸Šä¼  50MB æµ‹è¯•æ–‡ä»¶
node test-client.js test-upload 50 1234

# äº¤äº’æ¨¡å¼
node test-client.js test-upload 50 1234 --interactive
```

### 4. ä¸‹è½½æ–‡ä»¶

```bash
# ä¸‹è½½æ–‡ä»¶
node test-client.js download <file-id> 1234

# æŒ‡å®šè¾“å‡ºè·¯å¾„
node test-client.js download <file-id> 1234 /path/to/output.zip

# äº¤äº’æ¨¡å¼
node test-client.js download <file-id> 1234 -i
```

### 5. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
node test-client.js test-suite
```

æµ‹è¯•å¥—ä»¶åŒ…æ‹¬ï¼š
- âœ“ ä¸Šä¼  1MB å°æ–‡ä»¶
- âœ“ ä¸‹è½½æ–‡ä»¶
- âœ“ é”™è¯¯å¯†ç æµ‹è¯•

## å‘½ä»¤è¡Œå‚æ•°

### å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `upload <file> [password]` | ä¸Šä¼ æ–‡ä»¶ | `node test-client.js upload test.zip 1234` |
| `test-upload <size-mb> [password]` | ç”Ÿæˆå¹¶ä¸Šä¼ æµ‹è¯•æ–‡ä»¶ | `node test-client.js test-upload 100 1234` |
| `download <file-id> <password> [output]` | ä¸‹è½½æ–‡ä»¶ | `node test-client.js download abc123 1234` |
| `test-suite` | è¿è¡Œå®Œæ•´æµ‹è¯• | `node test-client.js test-suite` |

### é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `--interactive`, `--step`, `-i` | å¯ç”¨äº¤äº’æ¨¡å¼ï¼Œæ¯æ­¥æš‚åœ |

## é…ç½®

å¯ä»¥åœ¨è„šæœ¬ä¸­ä¿®æ”¹é…ç½®ï¼š

```javascript
const CONFIG = {
  BASE_URL: 'https://fastfile.zwi.monster',  // FastFile æœåŠ¡åœ°å€
  CHUNK_SIZE: 10 * 1024 * 1024,              // 10MB æ¯å—
  MAX_CONCURRENT: 4,                         // æœ€å¤§å¹¶å‘æ•°ï¼ˆç›®å‰æœªä½¿ç”¨ï¼‰
  DEFAULT_PASSWORD: '1234'                   // é»˜è®¤å¯†ç 
};
```

## ä¸Šä¼ æµç¨‹è¯¦è§£

### ä¼ ç»Ÿæ–¹å¼ï¼ˆé€šè¿‡ Workerï¼‰
```
Client â†’ Worker â†’ R2
  â†“
æ‰€æœ‰æ•°æ®ç»è¿‡ Workerï¼Œå ç”¨è®¡ç®—å’Œå¸¦å®½
```

### æ–°æ–¹å¼ï¼ˆç›´æ¥ä¸Šä¼ åˆ° R2ï¼‰
```
Client â†’ Worker (è·å–é¢„ç­¾å URL)
  â†“
Client â†’ R2 (ç›´æ¥ä¸Šä¼ )
  â†“
Client â†’ Worker (ç¡®è®¤å®Œæˆ)
```

**ä¼˜åŠ¿ï¼š**
- âœ“ Worker åªå¤„ç†å…ƒæ•°æ®ï¼Œä¸è½¬å‘æ–‡ä»¶æ•°æ®
- âœ“ å‡å°‘ Worker çš„ CPU å’Œå†…å­˜ä½¿ç”¨
- âœ“ ä¸Šä¼ é€Ÿåº¦æ›´å¿«ï¼ˆç›´è¿ R2ï¼‰
- âœ“ æ”¯æŒæ›´å¤§çš„æ–‡ä»¶

## è¾“å‡ºè¯´æ˜

### é¢œè‰²æ ‡è¯†

- ğŸ”µ é’è‰² - ä¿¡æ¯æç¤º
- ğŸŸ¢ ç»¿è‰² - æˆåŠŸæ“ä½œ
- ğŸ”´ çº¢è‰² - é”™è¯¯ä¿¡æ¯
- ğŸŸ¡ é»„è‰² - è­¦å‘Šä¿¡æ¯

### è¿›åº¦æ¡

```
Upload [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 65% 65.00MB/100.00MB 5.23MB/s ETA: 6.68s
```

- è¿›åº¦ç™¾åˆ†æ¯”
- å·²ä¸Šä¼ /æ€»å¤§å°
- å½“å‰é€Ÿåº¦
- é¢„è®¡å‰©ä½™æ—¶é—´

## è°ƒè¯•æŠ€å·§

### 1. è§‚å¯Ÿæ¯ä¸ªåˆ†å—çš„ä¸Šä¼ 

ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªåˆ†å—çš„è¯¦ç»†ä¿¡æ¯ï¼š
```bash
node test-client.js upload large-file.zip 1234 -i
```

æ¯ä¸ªåˆ†å—ä¸Šä¼ åä¼šæ˜¾ç¤ºï¼š
- Part ç¼–å·
- æ•°æ®å¤§å°
- ETag å€¼

### 2. æµ‹è¯•ä¸åŒå¤§å°çš„æ–‡ä»¶

```bash
# å°æ–‡ä»¶ (1MB)
node test-client.js test-upload 1 1234

# ä¸­ç­‰æ–‡ä»¶ (100MB)
node test-client.js test-upload 100 1234

# å¤§æ–‡ä»¶ (1GB)
node test-client.js test-upload 1000 1234
```

### 3. æµ‹è¯•ç½‘ç»œä¸­æ–­æ¢å¤

åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ï¼š
1. ä¸Šä¼ å‡ ä¸ªåˆ†å—åæš‚åœ
2. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
3. ç»§ç»­ä¸Šä¼ å‰©ä½™åˆ†å—

### 4. éªŒè¯ ETag

æ¯ä¸ªåˆ†å—ä¸Šä¼ åä¼šè¿”å› ETagï¼Œå¯ä»¥ç”¨äºï¼š
- éªŒè¯æ•°æ®å®Œæ•´æ€§
- è°ƒè¯• multipart upload é—®é¢˜
- æ£€æŸ¥æ˜¯å¦æœ‰åˆ†å—ä¸¢å¤±

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨é¢„ç­¾å URLï¼Ÿ

A: é¢„ç­¾å URL å…è®¸å®¢æˆ·ç«¯ç›´æ¥ä¸Šä¼ åˆ° R2ï¼Œä¸éœ€è¦ç»è¿‡ Worker è½¬å‘ï¼Œå‡å°‘äº†ï¼š
- Worker çš„è®¡ç®—è´Ÿæ‹…
- æ•°æ®ä¼ è¾“å»¶è¿Ÿ
- Worker çš„å¸¦å®½è´¹ç”¨

### Q: äº¤äº’æ¨¡å¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

A: äº¤äº’æ¨¡å¼åœ¨æ¯ä¸ªå…³é”®æ­¥éª¤æš‚åœï¼Œè®©ä½ å¯ä»¥ï¼š
- è§‚å¯Ÿæ¯ä¸ªåˆ†å—çš„ä¸Šä¼ çŠ¶æ€
- æ£€æŸ¥ ETag æ˜¯å¦æ­£ç¡®
- è°ƒè¯•ä¸Šä¼ é—®é¢˜
- éªŒè¯æœåŠ¡å™¨å“åº”

### Q: å¦‚ä½•æµ‹è¯•å¤§æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

A: ä½¿ç”¨ test-upload å‘½ä»¤ç”ŸæˆæŒ‡å®šå¤§å°çš„æµ‹è¯•æ–‡ä»¶ï¼š
```bash
# ç”Ÿæˆ 5GB æµ‹è¯•æ–‡ä»¶ï¼ˆéœ€è¦ä¸€äº›æ—¶é—´ï¼‰
node test-client.js test-upload 5000 1234
```

### Q: ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. FastFile æœåŠ¡æ˜¯å¦è¿è¡Œ
3. R2 é…ç½®æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ä¸­çš„è¯¦ç»†æç¤º

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1: å¿«é€Ÿæµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸

```bash
# ä¸Šä¼  1MB æµ‹è¯•æ–‡ä»¶
node test-client.js test-upload 1 1234

# å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤ºæ–‡ä»¶ ID å’Œä¸‹è½½é“¾æ¥
âœ“ File ID: abc123
âœ“ Download URL: https://fastfile.zwi.monster/d/abc123
```

### åœºæ™¯ 2: è°ƒè¯•åˆ†å—ä¸Šä¼ é—®é¢˜

```bash
# ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œè§‚å¯Ÿæ¯ä¸ªåˆ†å—
node test-client.js test-upload 50 1234 -i

# æ¯ä¸ªåˆ†å—ä¸Šä¼ åä¼šæ˜¾ç¤ºï¼š
âœ“ Part 1 uploaded, ETag: "abc123..."
Press Enter to continue...

# å¯ä»¥æ£€æŸ¥ ETag æ˜¯å¦æ­£ç¡®
```

### åœºæ™¯ 3: æµ‹è¯•å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½

```bash
# ä¸Šä¼  1GB æ–‡ä»¶ï¼Œè§‚å¯Ÿé€Ÿåº¦å’Œç¨³å®šæ€§
node test-client.js test-upload 1000 1234

# æŸ¥çœ‹è¿›åº¦æ¡å’Œé€Ÿåº¦ï¼š
Upload [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 60% 600.00MB/1.00GB 8.50MB/s ETA: 47.06s
```

### åœºæ™¯ 4: æµ‹è¯•ä¸‹è½½åŠŸèƒ½

```bash
# å…ˆä¸Šä¼ 
node test-client.js test-upload 10 1234
# è®°ä¸‹ file-id: abc123

# å†ä¸‹è½½
node test-client.js download abc123 1234 test-download.zip

# éªŒè¯æ–‡ä»¶
ls -lh test-download.zip
```

## å¼€å‘è¯´æ˜

### è„šæœ¬ç»“æ„

```
test-client.js
â”œâ”€â”€ CONFIG                  # é…ç½®å¸¸é‡
â”œâ”€â”€ é¢œè‰²è¾“å‡ºå‡½æ•°             # log, logSuccess, logError, etc.
â”œâ”€â”€ waitForKeyPress()       # äº¤äº’æ¨¡å¼æš‚åœ
â”œâ”€â”€ request()               # HTTP è¯·æ±‚å°è£…
â”œâ”€â”€ generateTestFile()      # ç”Ÿæˆæµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ formatSize()            # æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
â”œâ”€â”€ formatTime()            # æ ¼å¼åŒ–æ—¶é—´
â”œâ”€â”€ ProgressBar             # è¿›åº¦æ¡ç±»
â”œâ”€â”€ uploadFile()            # ä¸Šä¼ æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ testUpload()            # æµ‹è¯•ä¸Šä¼ 
â”œâ”€â”€ downloadFile()          # ä¸‹è½½æ–‡ä»¶
â”œâ”€â”€ runTestSuite()          # æµ‹è¯•å¥—ä»¶
â””â”€â”€ main()                  # ä¸»å‡½æ•°
```

### ä¿®æ”¹é…ç½®

ç¼–è¾‘ `test-client.js`ï¼Œä¿®æ”¹ `CONFIG` å¯¹è±¡ï¼š

```javascript
const CONFIG = {
  BASE_URL: 'https://your-domain.com',  // æ”¹ä¸ºä½ çš„åŸŸå
  CHUNK_SIZE: 20 * 1024 * 1024,         // æ”¹ä¸º 20MB
  MAX_CONCURRENT: 8,                    // æ”¹ä¸º 8 å¹¶å‘
  DEFAULT_PASSWORD: '0000'              // æ”¹ä¸ºé»˜è®¤å¯†ç 
};
```

### æ·»åŠ æ–°åŠŸèƒ½

åœ¨ `main()` å‡½æ•°ä¸­æ·»åŠ æ–°å‘½ä»¤ï¼š

```javascript
case 'your-command':
  await yourFunction();
  break;
```

## æ€§èƒ½åŸºå‡†

åœ¨æ ‡å‡†ç½‘ç»œç¯å¢ƒä¸‹ï¼ˆ100Mbpsï¼‰ï¼š

| æ–‡ä»¶å¤§å° | ä¸Šä¼ æ—¶é—´ | å¹³å‡é€Ÿåº¦ |
|---------|---------|---------|
| 1 MB    | ~0.2s   | 5 MB/s  |
| 10 MB   | ~1.5s   | 6.7 MB/s |
| 100 MB  | ~15s    | 6.7 MB/s |
| 1 GB    | ~2.5min | 6.8 MB/s |

*å®é™…é€Ÿåº¦å–å†³äºç½‘ç»œçŠ¶å†µå’Œ R2 åŒºåŸŸ*

## æ•…éšœæ’é™¤

### ä¸Šä¼ å¤±è´¥

1. **æ£€æŸ¥ç½‘ç»œ**ï¼š`curl https://fastfile.zwi.monster`
2. **æ£€æŸ¥æœåŠ¡**ï¼šè®¿é—®é¦–é¡µæŸ¥çœ‹æ˜¯å¦æ­£å¸¸
3. **æŸ¥çœ‹æ—¥å¿—**ï¼š`wrangler tail`ï¼ˆåœ¨æœåŠ¡ç«¯ï¼‰
4. **é‡è¯•**ï¼šä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œæ‰¾å‡ºå¤±è´¥çš„ part

### ETag ä¸åŒ¹é…

1. æ£€æŸ¥åˆ†å—å¤§å°æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ•°æ®æ˜¯å¦å®Œæ•´
3. é‡æ–°ä¸Šä¼ å¤±è´¥çš„ part

### è¶…æ—¶

1. å¢åŠ  CHUNK_SIZE å‡å°‘è¯·æ±‚æ¬¡æ•°
2. æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
3. ä½¿ç”¨æ›´ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ

## è®¸å¯è¯

MIT

---

**ç»´æŠ¤è€…**: FastFile Team
**æœ€åæ›´æ–°**: 2025-11-12
